trigger:
  - '*'

variables:
  buildConfiguration: 'Release'
  outputDirectory: '$(build.binariesDirectory)/$(buildConfiguration)'
  androidApkDirectory: 'Bitspace/Bitspace.Android/bin/$(buildConfiguration)/*.apk'

pool:
  vmImage: windows-latest

steps:    
- task: gitsync@1
  inputs:
    GitRepoUrl: 'https://drtardis1:$(GithubPAT)@github.com/DrTardis1/Bitspace.git'
- task: NuGetToolInstaller@1
- task: NuGetCommand@2
  inputs:
    restoreSolution: '**/*.sln'
    
- task: XamarinAndroid@1
  inputs:
    projectFile: '**/*Droid*.csproj'
    outputDirectory: '$(outputDirectory)'
    configuration: '$(buildConfiguration)'
    msbuildVersionOption: '16.0'

- task: AndroidSigning@3
  inputs:
    apkFiles: '**/*.apk'
    zipalign: false

- task: AppCenterDistribute@3
  inputs:
    serverEndpoint: 'App Center Connection'
    appSlug: 'drtardis1/Bitspace'
    appFile: '$(outputDirectory)/*.apk'
    symbolsOption: 'Android'
    releaseNotesOption: input
    releaseNotesInput: 'Release notes would go here, if there were any!'
    destinationType: 'groups'


